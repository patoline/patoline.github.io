<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="Start" href="index.html">
<link rel="previous" href="PageLayout.html">
<link rel="next" href="DbMemory.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Badness" rel="Chapter" href="Badness.html">
<link title="Box" rel="Chapter" href="Box.html">
<link title="Break" rel="Chapter" href="Break.html">
<link title="Complete" rel="Chapter" href="Complete.html">
<link title="ConfigFindFont" rel="Chapter" href="ConfigFindFont.html">
<link title="Debug" rel="Chapter" href="Debug.html">
<link title="DefaultMacros" rel="Chapter" href="DefaultMacros.html">
<link title="Diagrams" rel="Chapter" href="Diagrams.html">
<link title="Distance" rel="Chapter" href="Distance.html">
<link title="Document" rel="Chapter" href="Document.html">
<link title="Euler" rel="Chapter" href="Euler.html">
<link title="FontPattern" rel="Chapter" href="FontPattern.html">
<link title="Geometry" rel="Chapter" href="Geometry.html">
<link title="Maths" rel="Chapter" href="Maths.html">
<link title="Offset" rel="Chapter" href="Offset.html">
<link title="OutputDrawing" rel="Chapter" href="OutputDrawing.html">
<link title="Proj3d" rel="Chapter" href="Proj3d.html">
<link title="TypoLanguage" rel="Chapter" href="TypoLanguage.html">
<link title="Typography" rel="Chapter" href="Typography.html">
<link title="Verbatim" rel="Chapter" href="Verbatim.html">
<link title="Test_offset" rel="Chapter" href="Test_offset.html">
<link title="ConfigFindFontLeg" rel="Chapter" href="ConfigFindFontLeg.html">
<link title="Numerals" rel="Chapter" href="Numerals.html">
<link title="PageLayout" rel="Chapter" href="PageLayout.html">
<link title="Db" rel="Chapter" href="Db.html">
<link title="DbMemory" rel="Chapter" href="DbMemory.html"><link title="Encoding and decoding data in the database" rel="Section" href="#1_Encodinganddecodingdatainthedatabase">
<link title="Connection to databases " rel="Section" href="#1_Connectiontodatabases">
<link title="Hooks" rel="Section" href="#1_Hooks">
<link title="Utility functions" rel="Section" href="#1_Utilityfunctions">
<title>Db</title>
</head>
<body>
<div class="navbar"><a class="pre" href="PageLayout.html" title="PageLayout">Previous</a>
&nbsp;<a class="up" href="index.html" title="Index">Up</a>
&nbsp;<a class="post" href="DbMemory.html" title="DbMemory">Next</a>
</div>
<h1>Module <a href="type_Db.html">Db</a></h1>

<pre><span class="keyword">module</span> Db: <code class="code">sig</code> <a href="Db.html">..</a> <code class="code">end</code></pre><div class="info module top">
Managing authentication and associated data for interactive sessions.
<p>

Patoline documents can be interactive, allowing for example an audience
to connect remotely to a presentation and interact with it, possibly
changing some parts of it (such as answering a poll, results being
updated on-screen immediately).
<p>

This module provides tools for managing user sessions and a storage
space for key/value pairs associated to each session.<br>
</div>
<hr width="100%">
<br>
<h1 id="1_Encodinganddecodingdatainthedatabase">Encoding and decoding data in the database</h1><br>

<pre><code><span id="TYPEdata"><span class="keyword">type</span> <code class="type">'a</code> data</span> = {</code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTdata.name">name</span>&nbsp;: <code class="type">string</code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTdata.init">init</span>&nbsp;: <code class="type">'a</code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTdata.read">read</span>&nbsp;: <code class="type">unit -> 'a</code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTdata.write">write</span>&nbsp;: <code class="type">'a -> unit</code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTdata.reset">reset</span>&nbsp;: <code class="type">unit -> unit</code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTdata.distribution">distribution</span>&nbsp;: <code class="type">?group:string -> unit -> int * ('a * int) list</code>;</code></td>

</tr></table>
}



<pre><span id="EXCEPTIONDummyData"><span class="keyword">exception</span> DummyData</span></pre>
<div class="info ">
Exception raised when actually trying to use the <a href="Db.html#VALdummyData"><code class="code">Db.dummyData</code></a>
below.<br>
</div>

<pre><span id="VALdummyData"><span class="keyword">val</span> dummyData</span> : <code class="type">string <a href="Db.html#TYPEdata">data</a></code></pre><div class="info ">
Dummy inhabitant of type <a href="Db.html#TYPEdata"><code class="code">Db.data</code></a>, which can be used to
initialize data structure, but whose content should never be used
(calling any member function raises <a href="Db.html#EXCEPTIONDummyData"><code class="code">Db.DummyData</code></a>).<br>
</div>

<pre><code><span id="TYPEcoding"><span class="keyword">type</span> <code class="type">'a</code> coding</span> = {</code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTcoding.encode">encode</span>&nbsp;: <code class="type">'a -> string</code>;</code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" ><div class="info ">
Serializing some value of type <code class="code">'a</code> to a string which can be
  stored in database.<br>
</div>
</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTcoding.decode">decode</span>&nbsp;: <code class="type">string -> 'a</code>;</code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" ><div class="info ">
Parsing a string from the database and creating a value of type
  <code class="code">'a</code>. This should be the inverse of <code class="code">encode</code>.<br>
</div>
</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr></table>
}



<pre><span id="VALdefault_coding"><span class="keyword">val</span> default_coding</span> : <code class="type">'a <a href="Db.html#TYPEcoding">coding</a></code></pre><div class="info ">
Default polymorphic coding, using OCaml <code class="code">Marshal</code> module,
escaped using base64.<br>
</div>

<pre><span id="VALstring_coding"><span class="keyword">val</span> string_coding</span> : <code class="type">string <a href="Db.html#TYPEcoding">coding</a></code></pre><div class="info ">
Strings coding, which ony uses base64 escaping.<br>
</div>

<pre><span id="VALbool_coding"><span class="keyword">val</span> bool_coding</span> : <code class="type">bool <a href="Db.html#TYPEcoding">coding</a></code></pre><div class="info ">
Coding boolean as strings <code class="code">"true"</code> and <code class="code">"false"</code>. Any value other
than <code class="code">"true"</code> in the database is decoded as <code class="code">false</code>.<br>
</div>
<br>
<h1 id="1_Connectiontodatabases">Connection to databases </h1><br>

<pre><span class="keyword">module type</span> <a href="Db.DbInterface.html">DbInterface</a> = <code class="code">sig</code> <a href="Db.DbInterface.html">..</a> <code class="code">end</code></pre><div class="info">
Interface to be implemented by database managers
</div>

<pre><span class="keyword">module type</span> <a href="Db.DbInstance.html">DbInstance</a> = <code class="code">sig</code> <a href="Db.DbInstance.html">..</a> <code class="code">end</code></pre><div class="info">
Generic type for database instances
</div>

<pre><span id="TYPEdatabase"><span class="keyword">type</span> <code class="type"></code>database</span> = <code class="type">(module Db.DbInstance)</code> </pre>


<pre><code><span id="TYPEdb"><span class="keyword">type</span> <code class="type"></code>db</span> = {</code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTdb.db">db</span>&nbsp;: <code class="type">unit -> <a href="Db.html#TYPEdatabase">database</a></code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTdb.create_data">create_data</span>&nbsp;: <code class="type">'a.<br>         ?log:bool -><br>         ?visibility:Util.visibility -> 'a <a href="Db.html#TYPEcoding">coding</a> -> string -> 'a -> 'a <a href="Db.html#TYPEdata">data</a></code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTdb.disconnect">disconnect</span>&nbsp;: <code class="type">unit -> unit</code>;</code></td>

</tr></table>
}



<pre><span id="VALinit_db"><span class="keyword">val</span> init_db</span> : <code class="type">(module Db.DbInterface with type dbinfo = 'a) -> string -> 'a -> <a href="Db.html#TYPEdb">db</a></code></pre><br>
<h1 id="1_Hooks">Hooks</h1><br>

<pre><span id="VALinteraction_start_hook"><span class="keyword">val</span> interaction_start_hook</span> : <code class="type">(unit -> unit) list Pervasives.ref</code></pre><div class="info ">
List of functions called when the interactive session starts<br>
</div>

<pre><span id="VALread_hook"><span class="keyword">val</span> read_hook</span> : <code class="type">(string -> Util.visibility -> unit) list Pervasives.ref</code></pre><div class="info ">
Hooks called when some data is being read from a database<br>
</div>

<pre><span id="VALwrite_hook"><span class="keyword">val</span> write_hook</span> : <code class="type">(string -> Util.visibility -> unit) list Pervasives.ref</code></pre><div class="info ">
Hooks called when some data is being written to a database<br>
</div>

<pre><span id="VALrecord"><span class="keyword">val</span> record</span> : <code class="type">('a -> 'b -> unit) list Pervasives.ref -><br>       ('c -> 'd) -> 'c -> 'd * ('a * 'b) list</code></pre>
<pre><span id="VALstop_record"><span class="keyword">val</span> stop_record</span> : <code class="type">'a list Pervasives.ref -> ('b -> 'c) -> 'b -> 'c</code></pre>
<pre><span id="VALrecord_read"><span class="keyword">val</span> record_read</span> : <code class="type">('a -> 'b) -> 'a -> 'b * (string * Util.visibility) list</code></pre>
<pre><span id="VALrecord_write"><span class="keyword">val</span> record_write</span> : <code class="type">('a -> 'b) -> 'a -> (string * Util.visibility) list</code></pre>
<pre><span id="VALstop_record_read"><span class="keyword">val</span> stop_record_read</span> : <code class="type">('a -> 'b) -> 'a -> 'b</code></pre>
<pre><span id="VALstop_record_write"><span class="keyword">val</span> stop_record_write</span> : <code class="type">('a -> 'b) -> 'a -> 'b</code></pre>
<pre><span id="VALdo_interaction_start_hook"><span class="keyword">val</span> do_interaction_start_hook</span> : <code class="type">unit -> unit</code></pre><div class="info ">
Run all hooks in <a href="Db.html#VALinteraction_start_hook"><code class="code">Db.interaction_start_hook</code></a>.<br>
</div>

<pre><span id="VALdo_record_read"><span class="keyword">val</span> do_record_read</span> : <code class="type">'a <a href="Db.html#TYPEdata">data</a> -> Util.visibility -> unit</code></pre><div class="info ">
Run all hooks in <a href="Db.html#VALread_hook"><code class="code">Db.read_hook</code></a>.<br>
</div>

<pre><span id="VALdo_record_write"><span class="keyword">val</span> do_record_write</span> : <code class="type">'a <a href="Db.html#TYPEdata">data</a> -> Util.visibility -> unit</code></pre><div class="info ">
Run all hooks in <a href="Db.html#VALwrite_hook"><code class="code">Db.write_hook</code></a>.<br>
</div>
<br>
<h1 id="1_Utilityfunctions">Utility functions</h1><br>

<pre><span id="VALsessid"><span class="keyword">val</span> sessid</span> : <code class="type">(string * string * (string * string) list) option Pervasives.ref</code></pre>
<pre><span id="VALsecret"><span class="keyword">val</span> secret</span> : <code class="type">string Pervasives.ref</code></pre>
<pre><span id="VALmake_sessid"><span class="keyword">val</span> make_sessid</span> : <code class="type">unit -> string</code></pre>
<pre><span id="VALfriends_from_string"><span class="keyword">val</span> friends_from_string</span> : <code class="type">string -> (string * string) list</code></pre>
<pre><span id="VALfriends_to_string"><span class="keyword">val</span> friends_to_string</span> : <code class="type">(string * string) list -> string</code></pre></body></html>